<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>dRonin: flight/Libraries/math/lqg.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon_128x128.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">dRonin
   &#160;<span id="projectnumber">4ec2dbb</span>
   </div>
   <div id="projectbrief">dRonin&nbsp;firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lqg_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">lqg.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lqg_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful, but</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * for more details.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License along</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lqg_8h.html">lqg.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">        References</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">        =====================================================================================================</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">        General idea</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">                * Linear Gaussian Quadratic Control System (James Cotton (peabody124), Taulabs)</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">                  http://buildandcrash.blogspot.be/2016/10/linear-gaussian-quadratic-control-system.html</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">        Covariance calculation for LQR, instead of DARE</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">                * ECE5530: Multivariable Control Systems II (Dr. Gregory L. Plett)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">                  http://mocha-java.uccs.edu/ECE5530/ECE5530-CH03.pdf</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">                  (Page 34)</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga7aecda96d7c71118c7907b674490a3e6">   49</a></span>&#160;<span class="preprocessor">#define RTKF_SOLUTION_LIMIT                     150</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga58f13c75497f1761e13cbf39acf83abc">   50</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define LQR_SOLUTION_LIMIT                      1000</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">/* Bullshit to quickly make copypasta of MATLAB answers work. */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">   53</a></span>&#160;<span class="preprocessor">#define P00 P[0][0]</span></div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">   54</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P10 P[1][0]</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">   55</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P20 P[2][0]</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">   56</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P01 P[0][1]</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">   57</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P11 P[1][1]</span></div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga570de0df41df22c97e76c020be10ebe5">   58</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P21 P[2][1]</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">   59</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P02 P[0][2]</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">   60</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P12 P[1][2]</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">   61</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define P22 P[2][2]</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">   63</a></span>&#160;<span class="preprocessor">#define A00 A[0][0]</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaa9c8a71816927936216695bafcec4a75">   64</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A10 A[1][0]</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga0f72c217c2cac6efbfe84fbb41afb298">   65</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A20 A[2][0]</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">   66</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A01 A[0][1]</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">   67</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A11 A[1][1]</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaa464bb5d73d5326f59cfe1e6d2b38a2b">   68</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A21 A[2][1]</span></div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">   69</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A02 A[0][2]</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">   70</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A12 A[1][2]</span></div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">   71</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define A22 A[2][2]</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">   73</a></span>&#160;<span class="preprocessor">#define Q00 Q[0][0]</span></div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga693e3a9063a1e7582e682ffd4fe06f46">   74</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q10 Q[1][0]</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga81b513e8af18f9217399d0806cbdfb0e">   75</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q20 Q[2][0]</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="group___flight_math.html#gada4630d1056a70b2e8e0b5efa86f3c5e">   76</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q01 Q[0][1]</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">   77</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q11 Q[1][1]</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga99bb24769f4834ade22b53029ef59fea">   78</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q21 Q[2][1]</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga68e8c3b92d1880e54905caf103e93236">   79</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q02 Q[0][2]</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaa17f3fc65627eb4768c42c6b3c0e45c2">   80</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q12 Q[1][2]</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="group___flight_math.html#gae92799bea6457224d138516adeeb30c1">   81</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define Q22 Q[2][2]</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">   83</a></span>&#160;<span class="preprocessor">#define B0 B[0]</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">   84</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define B1 B[1]</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga6945d50f798e1fde624d70c74457090e">   85</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define B2 B[2]</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga8476f4a8de2c191433342c9ce896986a">   87</a></span>&#160;<span class="preprocessor">#define X0 X[0]</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga1964818ccd90a6173ea48cecb652feeb">   88</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define X1 X[1]</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga79ae03a0214cb30e57b9e8835f2a0019">   89</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define X2 X[2]</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">   91</a></span>&#160;<span class="preprocessor">#define K0 K[0]</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">   92</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define K1 K[1]</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">   93</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define K2 K[2]</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">        Kalman covariance cycle.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">        P = APA&#39; + Q</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">        K = PH&#39; (R+HPH&#39;)^-1</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">        P = (I-KH) P</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga1ad6e702c34b118d4f9db7eb6d445bc2">  102</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga1ad6e702c34b118d4f9db7eb6d445bc2">rtkf_calculate_covariance_3x3</a>(<span class="keywordtype">float</span> A[3][3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga1a9a9b26f7cab8703fc488c6cc258490">K</a>[3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#gaa4dd4832559078fffbbe0afa316c216c">P</a>[3][3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga9403e530c40ea2ed78fba00336d98645">Q</a>[3][3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a>)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;{</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordtype">float</span> nP[3][3];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        nP[0][0] = <a class="code" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a> + <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a>) + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#ga570de0df41df22c97e76c020be10ebe5">P21</a>) + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        nP[0][1] = <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#ga570de0df41df22c97e76c020be10ebe5">P21</a>) + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        nP[0][2] = <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        nP[1][0] = <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*(<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a>) + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*(<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*P21) + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*(<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        nP[1][1] = <a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a> + <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*(<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#ga570de0df41df22c97e76c020be10ebe5">P21</a>) + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*(<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*P22);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        nP[1][2] = <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*(A11*<a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        nP[2][0] = <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*(<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*P21 + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        nP[2][1] = <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*(A11*P21 + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        nP[2][2] = P22*<a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*<a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a> + <a class="code" href="group___flight_math.html#gae92799bea6457224d138516adeeb30c1">Q22</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        memcpy(P, nP, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*9);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordtype">float</span> S = <a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a> = <a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>/S;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a> = <a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>/S;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a> = <a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a>/S;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a> = <a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a> - <a class="code" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> = <a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> - <a class="code" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> = <a class="code" href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a> - <a class="code" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a> = <a class="code" href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a> - <a class="code" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        P21 = P21 - <a class="code" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        P22 = P22 - <a class="code" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        P00 = P00 - <a class="code" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        P01 = P01 - <a class="code" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        P02 = P02 - <a class="code" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a>*<a class="code" href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="structrtkf__state.html">  139</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structrtkf__state.html">rtkf_state</a> {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="structrtkf__state.html#a42d77de97e5ca327d6c469a0e02186dd">  141</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structrtkf__state.html#a42d77de97e5ca327d6c469a0e02186dd">solver_iterations</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">  143</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">A</a>[3][3];</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">  144</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">B</a>[3];</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="structrtkf__state.html#a114e6c27b4df7671f75a9b63555db6d0">  145</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#a114e6c27b4df7671f75a9b63555db6d0">K</a>[3];</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="structrtkf__state.html#a578c787ff5bbc11eb29112a31598ee64">  146</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#a578c787ff5bbc11eb29112a31598ee64">P</a>[3][3];</div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="structrtkf__state.html#af8e7511a8a2816fa559c2273b8aba3be">  147</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#af8e7511a8a2816fa559c2273b8aba3be">Q</a>[3][3];</div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="structrtkf__state.html#ab5115cc1e5b19ffd761bb68070afb809">  148</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#ab5115cc1e5b19ffd761bb68070afb809">R</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">  149</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[3];</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">  151</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">biaslim</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;};</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">        Repeat the Kalman covariance cycle for specified amount of iterations.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">        Tests show that 50 iterations should be plenty to become stable.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga7782671ecc5f2f9656c3ef3c88237fd4">  160</a></span>&#160; <span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga7782671ecc5f2f9656c3ef3c88237fd4">rtkf_stabilize_covariance</a>(<a class="code" href="structrtkf__state.html">rtkf_t</a> rtkf, <span class="keywordtype">int</span> iterations)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(rtkf);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a> = 0; <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a> &lt; iterations; <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a>++) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <a class="code" href="group___flight_math.html#ga1ad6e702c34b118d4f9db7eb6d445bc2">rtkf_calculate_covariance_3x3</a>(rtkf-&gt;<a class="code" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">A</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#a114e6c27b4df7671f75a9b63555db6d0">K</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#a578c787ff5bbc11eb29112a31598ee64">P</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#af8e7511a8a2816fa559c2273b8aba3be">Q</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#ab5115cc1e5b19ffd761bb68070afb809">R</a>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        rtkf-&gt;<a class="code" href="structrtkf__state.html#a42d77de97e5ca327d6c469a0e02186dd">solver_iterations</a> += iterations;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">        Kalman prediction</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">        X_k+1 = AX_k + Bu_k + K(y - HX)</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga9c047ca34710994dcd8fa96479580b9f">  174</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga9c047ca34710994dcd8fa96479580b9f">rtkf_prediction_step</a>(<span class="keywordtype">float</span> A[3][3], <span class="keywordtype">float</span> B[3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga1a9a9b26f7cab8703fc488c6cc258490">K</a>[3], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga878335db1805364cefebddb5eccfc282">X</a>[3], <span class="keywordtype">float</span> signal, <span class="keywordtype">float</span> input)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">float</span> nX0, nX1, nX2;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        nX0 = <a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*input + <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga8476f4a8de2c191433342c9ce896986a">X0</a> + <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga1964818ccd90a6173ea48cecb652feeb">X1</a> + <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a>*<a class="code" href="group___flight_math.html#ga79ae03a0214cb30e57b9e8835f2a0019">X2</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        nX1 = <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*input + <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#ga1964818ccd90a6173ea48cecb652feeb">X1</a> + <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a>*<a class="code" href="group___flight_math.html#ga79ae03a0214cb30e57b9e8835f2a0019">X2</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        nX2 = <a class="code" href="group___flight_math.html#ga6945d50f798e1fde624d70c74457090e">B2</a>*input + <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a>*<a class="code" href="group___flight_math.html#ga79ae03a0214cb30e57b9e8835f2a0019">X2</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="group___flight_math.html#ga8476f4a8de2c191433342c9ce896986a">X0</a> = nX0 - <a class="code" href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a>*(nX0 - signal);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="group___flight_math.html#ga1964818ccd90a6173ea48cecb652feeb">X1</a> = nX1 - <a class="code" href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a>*(nX0 - signal);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordtype">float</span> in2 = input*input;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        X2 = (nX2 - <a class="code" href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a>*(nX0 - signal)) * <a class="code" href="group___flight_math.html#gae7fa5c4383337339fe17371cd78d7264">bound_min_max</a>(1.0<a class="code" href="namespacepx__mkfw.html#ada4502124cbbf5a9984df3a21e079434">f</a> - in2*in2, 0, 1.0<a class="code" href="namespacepx__mkfw.html#ada4502124cbbf5a9984df3a21e079434">f</a>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga05efb217998562804d47e5e23d6cc18a">  188</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga05efb217998562804d47e5e23d6cc18a">rtkf_predict_axis</a>(<a class="code" href="structrtkf__state.html">rtkf_t</a> rtkf, <span class="keywordtype">float</span> signal, <span class="keywordtype">float</span> input, <span class="keywordtype">float</span> Xout[3])</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="group___flight_math.html#ga9c047ca34710994dcd8fa96479580b9f">rtkf_prediction_step</a>(rtkf-&gt;<a class="code" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">A</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">B</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#a114e6c27b4df7671f75a9b63555db6d0">K</a>, rtkf-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>, signal, input);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        rtkf-&gt;X2 = <a class="code" href="group___flight_math.html#gab53f96ff60025bfea084300f2cec575e">bound_sym</a>(rtkf-&gt;X2, rtkf-&gt;<a class="code" href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">biaslim</a>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        Xout[0] = rtkf-&gt;X0;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        Xout[1] = rtkf-&gt;X1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        Xout[2] = rtkf-&gt;X2;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">        Rate-torque Kalman filter system.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">        A = [   1   Beta*(tau-tau*e^(-Ts/tau))   -Ts*Beta+Beta*(tau-tau*e^(-Ts/tau))   ]</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">            [   0   e^(-Ts/tau)                  e^(-Ts/tau)-1                         ]</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">            [   0   0                            1                                     ]</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">        B = [   Ts*Beta-Beta*(tau-tau*e^(-Ts/tau))   ]</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">            [   1-e^(-Ts/tau)                        ]</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">            [   0                                    ]</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="group___flight_math.html#gacaead781b2123d17bb02d52a973dec3f">  210</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#gacaead781b2123d17bb02d52a973dec3f">rtkf_initialize_matrices_int</a>(<span class="keywordtype">float</span> A[3][3], <span class="keywordtype">float</span> B[3], <span class="keywordtype">float</span> beta, <span class="keywordtype">float</span> tau, <span class="keywordtype">float</span> Ts)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a> = 1;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a> = beta*(tau - tau*expf(-Ts/tau));</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a> = beta*(tau - tau*expf(-Ts/tau)) - Ts*beta;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a> = expf(-Ts/tau);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a> = expf(-Ts/tau) - 1;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a> = 1;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a> = Ts*beta - beta*(tau - tau*expf(-Ts/tau));</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a> = 1 - expf(-Ts/tau);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <a class="code" href="group___flight_math.html#ga6945d50f798e1fde624d70c74457090e">B2</a> = 0;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">        Q matrix set by experimentation.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">        R = 1000 seems a workable value for raw gyro input.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga7e9d482db29da35ebe8c2c78b7e58278">  229</a></span>&#160;<a class="code" href="structrtkf__state.html">rtkf_t</a> <a class="code" href="group___flight_math.html#ga7e9d482db29da35ebe8c2c78b7e58278">rtkf_create</a>(<span class="keywordtype">float</span> beta, <span class="keywordtype">float</span> tau, <span class="keywordtype">float</span> Ts, <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a>, <span class="keywordtype">float</span> q1, <span class="keywordtype">float</span> q2, <span class="keywordtype">float</span> q3, <span class="keywordtype">float</span> biaslim)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">struct </span><a class="code" href="structrtkf__state.html">rtkf_state</a> *<a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a> = <a class="code" href="group___p_i_o_s___h_e_a_p.html#gaf68ad55bd0dd2b1561d544a45d3c9533">PIOS_malloc_no_dma</a>(<span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(state);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        memset(state, 0, <span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="group___flight_math.html#gacaead781b2123d17bb02d52a973dec3f">rtkf_initialize_matrices_int</a>(state-&gt;<a class="code" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">A</a>, state-&gt;<a class="code" href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">B</a>, expf(beta), tau, Ts);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        state-&gt;Q00 = q1;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        state-&gt;Q11 = q2;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        state-&gt;Q22 = q3;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        state-&gt;<a class="code" href="structrtkf__state.html#ab5115cc1e5b19ffd761bb68070afb809">R</a> = <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        state-&gt;<a class="code" href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">biaslim</a> = <a class="code" href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">biaslim</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="group___flight_math.html#gae8cceae24d23efcb4cb2a0ca4a854972">  245</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___flight_math.html#gae8cceae24d23efcb4cb2a0ca4a854972">rtkf_is_solved</a>(<a class="code" href="structrtkf__state.html">rtkf_t</a> rtkf)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">return</span> rtkf-&gt;<a class="code" href="structrtkf__state.html#a42d77de97e5ca327d6c469a0e02186dd">solver_iterations</a> &gt;= <a class="code" href="group___flight_math.html#ga7aecda96d7c71118c7907b674490a3e6">RTKF_SOLUTION_LIMIT</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">        LQR covariance cycle.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">        P = A&#39;PA - A&#39;PB (R+B&#39;PB)^-1 B&#39;PA + Q</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga0ec0dc27c9b22e24e3402e68b981e311">  255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga0ec0dc27c9b22e24e3402e68b981e311">lqr_calculate_covariance_2x2</a>(<span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">A</a>[2][2], <span class="keywordtype">float</span> <a class="code" href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">B</a>[2], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#gaa4dd4832559078fffbbe0afa316c216c">P</a>[2][2], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga9403e530c40ea2ed78fba00336d98645">Q</a>[2][2])</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordtype">float</span> nP[2][2];</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a> = 1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordtype">float</span> B0B0 = <a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*<a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordtype">float</span> B1B1 = <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordtype">float</span> B0B1 = B0*<a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordtype">float</span> A00A00 = <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordtype">float</span> A01A01 = <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*<a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordtype">float</span> A11A11 = <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*<a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">float</span> P01P10 = <a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>*<a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordtype">float</span> P00P11 = <a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordtype">float</span> div = (R + B0B0*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + B1B1*P11 + B0B1*(<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + <a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>));</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        nP[0][0] = (<a class="code" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a>*R + <a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>*(A00A00*R + B0B0*<a class="code" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a>) +</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                B1B1*(P11*<a class="code" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a> + A00A00*(P00P11 - P01P10)) +</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                B0B1*<a class="code" href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a>*(<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + P10))</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            /</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            div;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordtype">float</span> common = A01*(<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>*R + B1B1*(P00P11 - P01P10)) - A11*B0B1*(P00P11 + P01P10);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        nP[1][0] = (A00*(A11*P10*R + common))</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            /</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            div;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        nP[0][1] = (A00*(A11*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>*R + common))</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            /</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            div;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        nP[1][1] = (<a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a>*R + A01A01*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>*R + B0B0*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a>*<a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a> +</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                A11A11*(P11*R + B0B0*(P00P11 - P01P10)) +</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                B1B1*(P11*<a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a> + A01A01*P00P11 - A01A01*P01P10) +</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                A01*A11*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>*R + A01*A11*P10*R + B0B1*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a>*<a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a> +</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                B0B1*(P10*<a class="code" href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a> - 2*A01*A11*P00P11 + 2*A01*A11*P01P10))</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                /</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                div;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> = nP[0][0];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> = nP[0][1];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        P10 = nP[1][0];</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        P11 = nP[1][1];</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="structlqr__state.html">  301</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlqr__state.html">lqr_state</a> {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">  303</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">solver_iterations</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">  305</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">A</a>[2][2];</div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">  306</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">B</a>[2];</div>
<div class="line"><a name="l00307"></a><span class="lineno"><a class="line" href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">  307</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">K</a>[2];</div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="structlqr__state.html#a22f401cb64cae7f7761b04b4575ea04b">  308</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a22f401cb64cae7f7761b04b4575ea04b">P</a>[2][2];</div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="structlqr__state.html#a3b7e710c6b77111ff82a9c66e1e4f566">  309</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a3b7e710c6b77111ff82a9c66e1e4f566">Q</a>[2][2];</div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="structlqr__state.html#a58aaaf468f6763ec5c3c989fcabe364e">  310</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a58aaaf468f6763ec5c3c989fcabe364e">u</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">  312</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">beta</a>;</div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="structlqr__state.html#a171f2bb48d3868be0d9101c896d02058">  313</a></span>&#160;        <span class="keywordtype">float</span> <a class="code" href="structlqr__state.html#a171f2bb48d3868be0d9101c896d02058">tau</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;};</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">        Calculate gains for LQR.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">        K = (R + B&#39;PB)^-1 B&#39;PA</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga39f5682e60984701ee8bb04ac6627855">  322</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga39f5682e60984701ee8bb04ac6627855">lqr_calculate_gains_int</a>(<span class="keywordtype">float</span> A[2][2], <span class="keywordtype">float</span> B[2], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#gaa4dd4832559078fffbbe0afa316c216c">P</a>[2][2], <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga1a9a9b26f7cab8703fc488c6cc258490">K</a>[2])</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;{</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a> = 1;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordtype">float</span> div = (R + <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a> + <a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*(<a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*(<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + <a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>)));</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        K[0] = (<a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a>*(<a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>)) / div;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        K[1] = (<a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a>*(<a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*<a class="code" href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a> + <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a>) + <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a>*(<a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a>*<a class="code" href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a> + <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a>*<a class="code" href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a>)) / div;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">        Repeat the LQR covariance cycle for as much iterations needed.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">        Discrete algrebraic Riccati &quot;solver&quot; for dumb people.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">        Experimentation shows that it needs at least 700-800 iterations to become stable. Stabilizing</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">        two rate-controller LQR systems (say for roll and pitch axis) with 1000 iterations works</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">        within a fraction of a second on an STM32F405.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">        The end results pretty much match covariances calculated with dare() in MATLAB. Calculated</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">        gains from this also match what dlqr() spits out.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">        Trying peabody124&#39;s old branch last year, his proper DARE solver using Eigen took the best of</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">        five seconds. It was a tri-state LQR though.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">        Changing the Q state weight matrix in middle operation usually seems to restabilize within</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">        a 100 cycles, so TxPID for tuning might qualify.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="group___flight_math.html#gafa8a4d4c5867f0c1079530e359dd9d82">  351</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#gafa8a4d4c5867f0c1079530e359dd9d82">lqr_stabilize_covariance</a>(<a class="code" href="structlqr__state.html">lqr_t</a> lqr, <span class="keywordtype">int</span> iterations)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(lqr);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a> = 0; <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a> &lt; iterations; <a class="code" href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a>++) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <a class="code" href="group___flight_math.html#ga0ec0dc27c9b22e24e3402e68b981e311">lqr_calculate_covariance_2x2</a>(lqr-&gt;<a class="code" href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">A</a>, lqr-&gt;<a class="code" href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">B</a>, lqr-&gt;<a class="code" href="structlqr__state.html#a22f401cb64cae7f7761b04b4575ea04b">P</a>, lqr-&gt;<a class="code" href="structlqr__state.html#a3b7e710c6b77111ff82a9c66e1e4f566">Q</a>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="group___flight_math.html#ga39f5682e60984701ee8bb04ac6627855">lqr_calculate_gains_int</a>(lqr-&gt;<a class="code" href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">A</a>, lqr-&gt;<a class="code" href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">B</a>, lqr-&gt;<a class="code" href="structlqr__state.html#a22f401cb64cae7f7761b04b4575ea04b">P</a>, lqr-&gt;<a class="code" href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">K</a>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        lqr-&gt;<a class="code" href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">solver_iterations</a> += iterations;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga4de1a48d5eda65f9f4408c83a47ccb12">  364</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___flight_math.html#ga4de1a48d5eda65f9f4408c83a47ccb12">lqr_is_solved</a>(<a class="code" href="structlqr__state.html">lqr_t</a> lqr)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">return</span> lqr-&gt;<a class="code" href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">solver_iterations</a> &gt;= <a class="code" href="group___flight_math.html#ga58f13c75497f1761e13cbf39acf83abc">LQR_SOLUTION_LIMIT</a>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">        LQR rate controller.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">        A = [   1   tau*Beta*(1-e^(-Ts/tau))   ]</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">            [   0   e^(-Ts/tau)                ]</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">        B = [   Ts*Beta-tau*Beta*(1-e^(-Ts/tau))   ]</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">            [   1-e^(-Ts/tau)                      ]</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga85e57012ad2344c917e68e7152fcba9c">  378</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga85e57012ad2344c917e68e7152fcba9c">lqr_initialize_matrices_int</a>(<span class="keywordtype">float</span> A[2][2], <span class="keywordtype">float</span> B[2], <span class="keywordtype">float</span> beta, <span class="keywordtype">float</span> tau, <span class="keywordtype">float</span> Ts)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <a class="code" href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a> = 1;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <a class="code" href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a> = -beta*tau*(expf(-Ts/tau) - 1);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="group___flight_math.html#gaa9c8a71816927936216695bafcec4a75">A10</a> = 0;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <a class="code" href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a> = expf(-Ts/tau);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a> = Ts*beta + beta*tau*(expf(-Ts/tau) - 1);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <a class="code" href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a> = 1 - expf(-Ts/tau);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">        Q1 and Q2 in the state weighting matrix penalizes rate and torque.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">        Need to talk to peabody124 about the difference in magnitude. Q2 uses frame invariance idea.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">        Current workable values for 5&quot; miniquads seems to be Q1 = 0.00001, Q2 = 0.00013333.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="group___flight_math.html#gaff1d205d8a084b068b0478b24288425f">  396</a></span>&#160;<a class="code" href="structlqr__state.html">lqr_t</a> <a class="code" href="group___flight_math.html#gaff1d205d8a084b068b0478b24288425f">lqr_create</a>(<span class="keywordtype">float</span> beta, <span class="keywordtype">float</span> tau, <span class="keywordtype">float</span> Ts, <span class="keywordtype">float</span> q1, <span class="keywordtype">float</span> q2)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;{</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keyword">struct </span><a class="code" href="structlqr__state.html">lqr_state</a> *<a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a> = <a class="code" href="group___p_i_o_s___h_e_a_p.html#gaf68ad55bd0dd2b1561d544a45d3c9533">PIOS_malloc_no_dma</a>(<span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(state);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        memset(state, 0, <span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <a class="code" href="group___flight_math.html#ga85e57012ad2344c917e68e7152fcba9c">lqr_initialize_matrices_int</a>(state-&gt;<a class="code" href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">A</a>, state-&gt;<a class="code" href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">B</a>, expf(beta), tau, Ts);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        state-&gt;Q00 = q1;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        state-&gt;Q11 = q2*expf(beta);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        state-&gt;<a class="code" href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">beta</a> = <a class="code" href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">beta</a>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        state-&gt;<a class="code" href="structlqr__state.html#a171f2bb48d3868be0d9101c896d02058">tau</a> = <a class="code" href="structlqr__state.html#a171f2bb48d3868be0d9101c896d02058">tau</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga4af82421cc98549fe739d7a8464a438a">  412</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga4af82421cc98549fe739d7a8464a438a">lqr_update</a>(<a class="code" href="structlqr__state.html">lqr_t</a> lqr, <span class="keywordtype">float</span> q1, <span class="keywordtype">float</span> q2)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(lqr);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        lqr-&gt;Q00 = q1;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        lqr-&gt;Q11 = q2*expf(lqr-&gt;<a class="code" href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">beta</a>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        lqr-&gt;<a class="code" href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">solver_iterations</a> = 0;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga38d510514079e13279aeb8231945d971">  421</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga38d510514079e13279aeb8231945d971">lqr_get_gains</a>(<a class="code" href="structlqr__state.html">lqr_t</a> lqr, <span class="keywordtype">float</span> <a class="code" href="group___i_n_s_g_p_s.html#ga1a9a9b26f7cab8703fc488c6cc258490">K</a>[2])</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(lqr);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        K[0] = lqr-&gt;<a class="code" href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">K</a>[0];</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        K[1] = lqr-&gt;<a class="code" href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">K</a>[1];</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="structlqg__state.html">  429</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlqg__state.html">lqg_state</a> {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="structlqg__state.html#aa9640f2bc3f085c05bb872afff4b6028">  431</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structlqg__state.html#aa9640f2bc3f085c05bb872afff4b6028">axis</a>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno"><a class="line" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">  433</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="structlqr__state.html">lqr_state</a> *<a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">  434</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="structrtkf__state.html">rtkf_state</a> *<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;};</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">        Estimate the system state, i.e. presumed true rate and torque, then</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">        feed it into the LQR.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">        xr = x - setpoint</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">        u = -K*xr + bias</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">        u gets clamped to -1..1 because that&#39;s the actuator range. Might also prevent the</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">        RTKF to go overboard with predicting, when the LQR is trying to demand a lot from the</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">        actuators.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga285430f44ab2578fa8b890a051a0ce94">  450</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="group___flight_math.html#ga285430f44ab2578fa8b890a051a0ce94">lqg_controller</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg, <span class="keywordtype">float</span> signal, <span class="keywordtype">float</span> setpoint)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="structlqr__state.html">lqr_t</a> lqr = lqg-&gt;<a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <a class="code" href="structrtkf__state.html">rtkf_t</a> rtkf = lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordtype">float</span> x_est[3]; <span class="comment">/* Rate, Torque, Bias */</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <a class="code" href="group___flight_math.html#ga05efb217998562804d47e5e23d6cc18a">rtkf_predict_axis</a>(rtkf, signal, lqr-&gt;<a class="code" href="structlqr__state.html#a58aaaf468f6763ec5c3c989fcabe364e">u</a>, x_est);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordtype">float</span> xr0 = x_est[0] - setpoint;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordtype">float</span> u = x_est[2] - lqr-&gt;K0 * xr0 - lqr-&gt;K1 * x_est[1];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span> (u &lt; -1) u = -1;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (u &gt; 1) u = 1;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        lqr-&gt;<a class="code" href="structlqr__state.html#a58aaaf468f6763ec5c3c989fcabe364e">u</a> = u;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">return</span> u;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="group___flight_math.html#gac1eb6dd704623f47aef263a9cbf55561">  469</a></span>&#160;<a class="code" href="structlqg__state.html">lqg_t</a> <a class="code" href="group___flight_math.html#gac1eb6dd704623f47aef263a9cbf55561">lqg_create</a>(<a class="code" href="structrtkf__state.html">rtkf_t</a> rtkf, <a class="code" href="structlqr__state.html">lqr_t</a> lqr)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;{</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(rtkf);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(lqr);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keyword">struct </span><a class="code" href="structlqg__state.html">lqg_state</a> *<a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a> = <a class="code" href="group___p_i_o_s___h_e_a_p.html#gaf68ad55bd0dd2b1561d544a45d3c9533">PIOS_malloc_no_dma</a>(<span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(state);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        memset(state, 0, <span class="keyword">sizeof</span>(*state));</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        state-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a> = <a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        state-&gt;<a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a> = <a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga502766f4c789280a257096ed8aff3c3b">  484</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga502766f4c789280a257096ed8aff3c3b">lqg_get_rtkf_state</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg, <span class="keywordtype">float</span> *<a class="code" href="msp__messages_8h.html#a788e7e096258bec32986d7b2c00adebb">rate</a>, <span class="keywordtype">float</span> *torque, <span class="keywordtype">float</span> *bias)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        *rate = lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[0];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        *torque = lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[1];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        *bias = lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[2];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;}</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga536a61d891026a08fcc40c855d1e21a7">  491</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga536a61d891026a08fcc40c855d1e21a7">lqg_set_x0</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg, <span class="keywordtype">float</span> x0)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[0] = x0;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[1] = 0;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>-&gt;<a class="code" href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">X</a>[2] = 0;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;}</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga49e1cb9d119c0af92c6a35839b00aed6">  498</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="group___flight_math.html#ga49e1cb9d119c0af92c6a35839b00aed6">lqg_is_solved</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;{</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">return</span> lqg != NULL &amp;&amp; <a class="code" href="group___flight_math.html#ga4de1a48d5eda65f9f4408c83a47ccb12">lqr_is_solved</a>(lqg-&gt;<a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a>) &amp;&amp; <a class="code" href="group___flight_math.html#gae8cceae24d23efcb4cb2a0ca4a854972">rtkf_is_solved</a>(lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga18c51a43685fb151a21bb055a4d3fcef">  503</a></span>&#160;<a class="code" href="structrtkf__state.html">rtkf_t</a> <a class="code" href="group___flight_math.html#ga18c51a43685fb151a21bb055a4d3fcef">lqg_get_rtkf</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">return</span> lqg ? lqg-&gt;<a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a> : NULL;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga8af68f18f918749f0badcfe9c39aeaf1">  508</a></span>&#160;<a class="code" href="structlqr__state.html">lqr_t</a> <a class="code" href="group___flight_math.html#ga8af68f18f918749f0badcfe9c39aeaf1">lqg_get_lqr</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;{</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">return</span> lqg ? lqg-&gt;<a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a> : NULL;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="group___flight_math.html#ga97e9b30062b984f6d99412200fa7f8f8">  513</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___flight_math.html#ga97e9b30062b984f6d99412200fa7f8f8">lqg_run_covariance</a>(<a class="code" href="structlqg__state.html">lqg_t</a> lqg, <span class="keywordtype">int</span> iter)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;{</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="structrtkf__state.html">rtkf_t</a> <a class="code" href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">rtkf</a> = <a class="code" href="group___flight_math.html#ga18c51a43685fb151a21bb055a4d3fcef">lqg_get_rtkf</a>(lqg);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <a class="code" href="structlqr__state.html">lqr_t</a> <a class="code" href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqr</a> = <a class="code" href="group___flight_math.html#ga8af68f18f918749f0badcfe9c39aeaf1">lqg_get_lqr</a>(lqg);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(rtkf);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <a class="code" href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a>(lqr);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="group___flight_math.html#gae8cceae24d23efcb4cb2a0ca4a854972">rtkf_is_solved</a>(rtkf))</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <a class="code" href="group___flight_math.html#ga7782671ecc5f2f9656c3ef3c88237fd4">rtkf_stabilize_covariance</a>(rtkf, iter);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="group___flight_math.html#ga4de1a48d5eda65f9f4408c83a47ccb12">lqr_is_solved</a>(lqr))</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <a class="code" href="group___flight_math.html#gafa8a4d4c5867f0c1079530e359dd9d82">lqr_stabilize_covariance</a>(lqr, iter);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;}</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="ttc" id="structlqr__state_html_a59aebad73e32212fc5450c632bbcf60e"><div class="ttname"><a href="structlqr__state.html#a59aebad73e32212fc5450c632bbcf60e">lqr_state::A</a></div><div class="ttdeci">float A[2][2]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00305">lqg.c:305</a></div></div>
<div class="ttc" id="structrtkf__state_html_abf0483841b80f0e94d84cee663e46dc8"><div class="ttname"><a href="structrtkf__state.html#abf0483841b80f0e94d84cee663e46dc8">rtkf_state::B</a></div><div class="ttdeci">float B[3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00144">lqg.c:144</a></div></div>
<div class="ttc" id="group___flight_math_html_ga39f5682e60984701ee8bb04ac6627855"><div class="ttname"><a href="group___flight_math.html#ga39f5682e60984701ee8bb04ac6627855">lqr_calculate_gains_int</a></div><div class="ttdeci">void lqr_calculate_gains_int(float A[2][2], float B[2], float P[2][2], float K[2])</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00322">lqg.c:322</a></div></div>
<div class="ttc" id="lqg_8h_html"><div class="ttname"><a href="lqg_8h.html">lqg.h</a></div><div class="ttdoc">LQG Control algorithm. </div></div>
<div class="ttc" id="group___flight_math_html_gae8cceae24d23efcb4cb2a0ca4a854972"><div class="ttname"><a href="group___flight_math.html#gae8cceae24d23efcb4cb2a0ca4a854972">rtkf_is_solved</a></div><div class="ttdeci">bool rtkf_is_solved(rtkf_t rtkf)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00245">lqg.c:245</a></div></div>
<div class="ttc" id="group___flight_math_html_ga29ab8f304572bfb421e3f7666da0fe4d"><div class="ttname"><a href="group___flight_math.html#ga29ab8f304572bfb421e3f7666da0fe4d">A00</a></div><div class="ttdeci">#define A00</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00063">lqg.c:63</a></div></div>
<div class="ttc" id="group___i_n_s_g_p_s_html_ga9403e530c40ea2ed78fba00336d98645"><div class="ttname"><a href="group___i_n_s_g_p_s.html#ga9403e530c40ea2ed78fba00336d98645">Q</a></div><div class="ttdeci">float Q[NUMW]</div><div class="ttdef"><b>Definition:</b> <a href="insgps14state_8c_source.html#l00067">insgps14state.c:67</a></div></div>
<div class="ttc" id="group___flight_math_html_ga6945d50f798e1fde624d70c74457090e"><div class="ttname"><a href="group___flight_math.html#ga6945d50f798e1fde624d70c74457090e">B2</a></div><div class="ttdeci">#define B2</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00085">lqg.c:85</a></div></div>
<div class="ttc" id="group___flight_math_html_ga2667934cffb93b5b656fbb9b11495d52"><div class="ttname"><a href="group___flight_math.html#ga2667934cffb93b5b656fbb9b11495d52">Q11</a></div><div class="ttdeci">#define Q11</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00077">lqg.c:77</a></div></div>
<div class="ttc" id="group___flight_math_html_ga18c51a43685fb151a21bb055a4d3fcef"><div class="ttname"><a href="group___flight_math.html#ga18c51a43685fb151a21bb055a4d3fcef">lqg_get_rtkf</a></div><div class="ttdeci">rtkf_t lqg_get_rtkf(lqg_t lqg)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00503">lqg.c:503</a></div></div>
<div class="ttc" id="group___flight_math_html_ga307c72605e3713972b4f4fb2d53ea20e"><div class="ttname"><a href="group___flight_math.html#ga307c72605e3713972b4f4fb2d53ea20e">K0</a></div><div class="ttdeci">#define K0</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00091">lqg.c:91</a></div></div>
<div class="ttc" id="group___flight_math_html_ga1964818ccd90a6173ea48cecb652feeb"><div class="ttname"><a href="group___flight_math.html#ga1964818ccd90a6173ea48cecb652feeb">X1</a></div><div class="ttdeci">#define X1</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00088">lqg.c:88</a></div></div>
<div class="ttc" id="structlqr__state_html_a44f8723e49b0ca8e9ed9ab7821cffc1a"><div class="ttname"><a href="structlqr__state.html#a44f8723e49b0ca8e9ed9ab7821cffc1a">lqr_state::beta</a></div><div class="ttdeci">float beta</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00312">lqg.c:312</a></div></div>
<div class="ttc" id="structrtkf__state_html_a42d77de97e5ca327d6c469a0e02186dd"><div class="ttname"><a href="structrtkf__state.html#a42d77de97e5ca327d6c469a0e02186dd">rtkf_state::solver_iterations</a></div><div class="ttdeci">int solver_iterations</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00141">lqg.c:141</a></div></div>
<div class="ttc" id="structrtkf__state_html_a578c787ff5bbc11eb29112a31598ee64"><div class="ttname"><a href="structrtkf__state.html#a578c787ff5bbc11eb29112a31598ee64">rtkf_state::P</a></div><div class="ttdeci">float P[3][3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00146">lqg.c:146</a></div></div>
<div class="ttc" id="group___flight_math_html_ga7782671ecc5f2f9656c3ef3c88237fd4"><div class="ttname"><a href="group___flight_math.html#ga7782671ecc5f2f9656c3ef3c88237fd4">rtkf_stabilize_covariance</a></div><div class="ttdeci">void rtkf_stabilize_covariance(rtkf_t rtkf, int iterations)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00160">lqg.c:160</a></div></div>
<div class="ttc" id="group___flight_math_html_ga79ae03a0214cb30e57b9e8835f2a0019"><div class="ttname"><a href="group___flight_math.html#ga79ae03a0214cb30e57b9e8835f2a0019">X2</a></div><div class="ttdeci">#define X2</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00089">lqg.c:89</a></div></div>
<div class="ttc" id="structlqr__state_html_ade31d9726a135503ebb30da703720c15"><div class="ttname"><a href="structlqr__state.html#ade31d9726a135503ebb30da703720c15">lqr_state::solver_iterations</a></div><div class="ttdeci">int solver_iterations</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00303">lqg.c:303</a></div></div>
<div class="ttc" id="group___i_n_s_g_p_s_html_ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7"><div class="ttname"><a href="group___i_n_s_g_p_s.html#ga06fb8e491fbcc3c8cbe00ccaa0aa1aa7">R</a></div><div class="ttdeci">float R[NUMV]</div><div class="ttdef"><b>Definition:</b> <a href="insgps14state_8c_source.html#l00067">insgps14state.c:67</a></div></div>
<div class="ttc" id="group___flight_math_html_ga4bf72b9e10032d0e1ac2a371bcec73d5"><div class="ttname"><a href="group___flight_math.html#ga4bf72b9e10032d0e1ac2a371bcec73d5">P01</a></div><div class="ttdeci">#define P01</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00056">lqg.c:56</a></div></div>
<div class="ttc" id="group___flight_math_html_gac1eb6dd704623f47aef263a9cbf55561"><div class="ttname"><a href="group___flight_math.html#gac1eb6dd704623f47aef263a9cbf55561">lqg_create</a></div><div class="ttdeci">lqg_t lqg_create(rtkf_t rtkf, lqr_t lqr)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00469">lqg.c:469</a></div></div>
<div class="ttc" id="group___flight_math_html_ga38d510514079e13279aeb8231945d971"><div class="ttname"><a href="group___flight_math.html#ga38d510514079e13279aeb8231945d971">lqr_get_gains</a></div><div class="ttdeci">void lqr_get_gains(lqr_t lqr, float K[2])</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00421">lqg.c:421</a></div></div>
<div class="ttc" id="group___flight_math_html_ga5bb9f89248afa8d7e5a821fd459b085f"><div class="ttname"><a href="group___flight_math.html#ga5bb9f89248afa8d7e5a821fd459b085f">P10</a></div><div class="ttdeci">#define P10</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00054">lqg.c:54</a></div></div>
<div class="ttc" id="group___flight_math_html_ga7aecda96d7c71118c7907b674490a3e6"><div class="ttname"><a href="group___flight_math.html#ga7aecda96d7c71118c7907b674490a3e6">RTKF_SOLUTION_LIMIT</a></div><div class="ttdeci">#define RTKF_SOLUTION_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00049">lqg.c:49</a></div></div>
<div class="ttc" id="group___flight_math_html_ga8476f4a8de2c191433342c9ce896986a"><div class="ttname"><a href="group___flight_math.html#ga8476f4a8de2c191433342c9ce896986a">X0</a></div><div class="ttdeci">#define X0</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00087">lqg.c:87</a></div></div>
<div class="ttc" id="group___flight_math_html_ga8a03ef52aa4926d1d75cb647ac768622"><div class="ttname"><a href="group___flight_math.html#ga8a03ef52aa4926d1d75cb647ac768622">B0</a></div><div class="ttdeci">#define B0</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00083">lqg.c:83</a></div></div>
<div class="ttc" id="group___i_n_s_g_p_s_html_gaa4dd4832559078fffbbe0afa316c216c"><div class="ttname"><a href="group___i_n_s_g_p_s.html#gaa4dd4832559078fffbbe0afa316c216c">P</a></div><div class="ttdeci">float P[NUMX][NUMX]</div><div class="ttdef"><b>Definition:</b> <a href="insgps14state_8c_source.html#l00066">insgps14state.c:66</a></div></div>
<div class="ttc" id="group___flight_math_html_ga0ec0dc27c9b22e24e3402e68b981e311"><div class="ttname"><a href="group___flight_math.html#ga0ec0dc27c9b22e24e3402e68b981e311">lqr_calculate_covariance_2x2</a></div><div class="ttdeci">void lqr_calculate_covariance_2x2(float A[2][2], float B[2], float P[2][2], float Q[2][2])</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00255">lqg.c:255</a></div></div>
<div class="ttc" id="group___flight_math_html_ga8af68f18f918749f0badcfe9c39aeaf1"><div class="ttname"><a href="group___flight_math.html#ga8af68f18f918749f0badcfe9c39aeaf1">lqg_get_lqr</a></div><div class="ttdeci">lqr_t lqg_get_lqr(lqg_t lqg)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00508">lqg.c:508</a></div></div>
<div class="ttc" id="group___flight_math_html_gab6d0e745059aded06587e4b6933bca0b"><div class="ttname"><a href="group___flight_math.html#gab6d0e745059aded06587e4b6933bca0b">K2</a></div><div class="ttdeci">#define K2</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00093">lqg.c:93</a></div></div>
<div class="ttc" id="group___flight_math_html_ga9c047ca34710994dcd8fa96479580b9f"><div class="ttname"><a href="group___flight_math.html#ga9c047ca34710994dcd8fa96479580b9f">rtkf_prediction_step</a></div><div class="ttdeci">void rtkf_prediction_step(float A[3][3], float B[3], float K[3], float X[3], float signal, float input)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00174">lqg.c:174</a></div></div>
<div class="ttc" id="group___flight_math_html_gaad2e9e6463865ce4ee5c0fdb487ae564"><div class="ttname"><a href="group___flight_math.html#gaad2e9e6463865ce4ee5c0fdb487ae564">P22</a></div><div class="ttdeci">#define P22</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00061">lqg.c:61</a></div></div>
<div class="ttc" id="group___flight_math_html_ga536a61d891026a08fcc40c855d1e21a7"><div class="ttname"><a href="group___flight_math.html#ga536a61d891026a08fcc40c855d1e21a7">lqg_set_x0</a></div><div class="ttdeci">void lqg_set_x0(lqg_t lqg, float x0)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00491">lqg.c:491</a></div></div>
<div class="ttc" id="group___p_i_o_s___h_e_a_p_html_gaf68ad55bd0dd2b1561d544a45d3c9533"><div class="ttname"><a href="group___p_i_o_s___h_e_a_p.html#gaf68ad55bd0dd2b1561d544a45d3c9533">PIOS_malloc_no_dma</a></div><div class="ttdeci">void * PIOS_malloc_no_dma(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="_pi_o_s_2_common_2pios__heap_8c_source.html#l00166">pios_heap.c:166</a></div></div>
<div class="ttc" id="structlqg__state_html_a70f96158665ed6bab58e742620d503a2"><div class="ttname"><a href="structlqg__state.html#a70f96158665ed6bab58e742620d503a2">lqg_state::rtkf</a></div><div class="ttdeci">struct rtkf_state * rtkf</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00434">lqg.c:434</a></div></div>
<div class="ttc" id="group___flight_math_html_gaa9c8a71816927936216695bafcec4a75"><div class="ttname"><a href="group___flight_math.html#gaa9c8a71816927936216695bafcec4a75">A10</a></div><div class="ttdeci">#define A10</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00064">lqg.c:64</a></div></div>
<div class="ttc" id="group___flight_math_html_gaca6db006bc37d2b337fca225a79856c8"><div class="ttname"><a href="group___flight_math.html#gaca6db006bc37d2b337fca225a79856c8">P11</a></div><div class="ttdeci">#define P11</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00057">lqg.c:57</a></div></div>
<div class="ttc" id="structlqr__state_html_ad7297f0654249d400dc75593b0578aa0"><div class="ttname"><a href="structlqr__state.html#ad7297f0654249d400dc75593b0578aa0">lqr_state::K</a></div><div class="ttdeci">float K[2]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00307">lqg.c:307</a></div></div>
<div class="ttc" id="group___flight_math_html_ga4af82421cc98549fe739d7a8464a438a"><div class="ttname"><a href="group___flight_math.html#ga4af82421cc98549fe739d7a8464a438a">lqr_update</a></div><div class="ttdeci">void lqr_update(lqr_t lqr, float q1, float q2)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00412">lqg.c:412</a></div></div>
<div class="ttc" id="group___flight_math_html_gaa070611aceceab6976d41423e092da9f"><div class="ttname"><a href="group___flight_math.html#gaa070611aceceab6976d41423e092da9f">Q00</a></div><div class="ttdeci">#define Q00</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00073">lqg.c:73</a></div></div>
<div class="ttc" id="group___flight_math_html_ga7b21d6a6a4573b4997b1f04b01cd4efb"><div class="ttname"><a href="group___flight_math.html#ga7b21d6a6a4573b4997b1f04b01cd4efb">B1</a></div><div class="ttdeci">#define B1</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00084">lqg.c:84</a></div></div>
<div class="ttc" id="structrtkf__state_html_a1102fcc1c986b891ff2cbd8e0cfea00a"><div class="ttname"><a href="structrtkf__state.html#a1102fcc1c986b891ff2cbd8e0cfea00a">rtkf_state::A</a></div><div class="ttdeci">float A[3][3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00143">lqg.c:143</a></div></div>
<div class="ttc" id="group___flight_math_html_ga1e90f508a7fea35178f4e797316bea02"><div class="ttname"><a href="group___flight_math.html#ga1e90f508a7fea35178f4e797316bea02">P02</a></div><div class="ttdeci">#define P02</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00059">lqg.c:59</a></div></div>
<div class="ttc" id="group___flight_math_html_gafa8a4d4c5867f0c1079530e359dd9d82"><div class="ttname"><a href="group___flight_math.html#gafa8a4d4c5867f0c1079530e359dd9d82">lqr_stabilize_covariance</a></div><div class="ttdeci">void lqr_stabilize_covariance(lqr_t lqr, int iterations)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00351">lqg.c:351</a></div></div>
<div class="ttc" id="group___flight_math_html_ga570de0df41df22c97e76c020be10ebe5"><div class="ttname"><a href="group___flight_math.html#ga570de0df41df22c97e76c020be10ebe5">P21</a></div><div class="ttdeci">#define P21</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00058">lqg.c:58</a></div></div>
<div class="ttc" id="structlqg__state_html"><div class="ttname"><a href="structlqg__state.html">lqg_state</a></div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00429">lqg.c:429</a></div></div>
<div class="ttc" id="structrtkf__state_html_ab5115cc1e5b19ffd761bb68070afb809"><div class="ttname"><a href="structrtkf__state.html#ab5115cc1e5b19ffd761bb68070afb809">rtkf_state::R</a></div><div class="ttdeci">float R</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00148">lqg.c:148</a></div></div>
<div class="ttc" id="structlqg__state_html_aa9640f2bc3f085c05bb872afff4b6028"><div class="ttname"><a href="structlqg__state.html#aa9640f2bc3f085c05bb872afff4b6028">lqg_state::axis</a></div><div class="ttdeci">int axis</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00431">lqg.c:431</a></div></div>
<div class="ttc" id="structrtkf__state_html"><div class="ttname"><a href="structrtkf__state.html">rtkf_state</a></div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00139">lqg.c:139</a></div></div>
<div class="ttc" id="structlqg__state_html_a0474b96d212645e6da8d4db589e9b8a9"><div class="ttname"><a href="structlqg__state.html#a0474b96d212645e6da8d4db589e9b8a9">lqg_state::lqr</a></div><div class="ttdeci">struct lqr_state * lqr</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00433">lqg.c:433</a></div></div>
<div class="ttc" id="structlqr__state_html_a1e640ff2836fb8011e36480dcfbb9c97"><div class="ttname"><a href="structlqr__state.html#a1e640ff2836fb8011e36480dcfbb9c97">lqr_state::B</a></div><div class="ttdeci">float B[2]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00306">lqg.c:306</a></div></div>
<div class="ttc" id="structrtkf__state_html_ae60d773307e36f52fd535711b8789407"><div class="ttname"><a href="structrtkf__state.html#ae60d773307e36f52fd535711b8789407">rtkf_state::X</a></div><div class="ttdeci">float X[3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00149">lqg.c:149</a></div></div>
<div class="ttc" id="group___flight_math_html_ga85e57012ad2344c917e68e7152fcba9c"><div class="ttname"><a href="group___flight_math.html#ga85e57012ad2344c917e68e7152fcba9c">lqr_initialize_matrices_int</a></div><div class="ttdeci">void lqr_initialize_matrices_int(float A[2][2], float B[2], float beta, float tau, float Ts)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00378">lqg.c:378</a></div></div>
<div class="ttc" id="msp__messages_8h_html_af27e3188294c2df66d975b74a09c001d"><div class="ttname"><a href="msp__messages_8h.html#af27e3188294c2df66d975b74a09c001d">i</a></div><div class="ttdeci">uint8_t i</div><div class="ttdef"><b>Definition:</b> <a href="msp__messages_8h_source.html#l00097">msp_messages.h:97</a></div></div>
<div class="ttc" id="group___flight_math_html_gae7fa5c4383337339fe17371cd78d7264"><div class="ttname"><a href="group___flight_math.html#gae7fa5c4383337339fe17371cd78d7264">bound_min_max</a></div><div class="ttdeci">float bound_min_max(float val, float min, float max)</div><div class="ttdoc">Bound input value between min and max. </div><div class="ttdef"><b>Definition:</b> <a href="misc__math_8c_source.html#l00038">misc_math.c:38</a></div></div>
<div class="ttc" id="group___flight_math_html_gaff1d205d8a084b068b0478b24288425f"><div class="ttname"><a href="group___flight_math.html#gaff1d205d8a084b068b0478b24288425f">lqr_create</a></div><div class="ttdeci">lqr_t lqr_create(float beta, float tau, float Ts, float q1, float q2)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00396">lqg.c:396</a></div></div>
<div class="ttc" id="group___flight_math_html_gab53f96ff60025bfea084300f2cec575e"><div class="ttname"><a href="group___flight_math.html#gab53f96ff60025bfea084300f2cec575e">bound_sym</a></div><div class="ttdeci">float bound_sym(float val, float range)</div><div class="ttdoc">Bound input value within range (plus or minus) </div><div class="ttdef"><b>Definition:</b> <a href="misc__math_8c_source.html#l00050">misc_math.c:50</a></div></div>
<div class="ttc" id="group___flight_math_html_ga5663784dabb95a65df02aa05f514f61a"><div class="ttname"><a href="group___flight_math.html#ga5663784dabb95a65df02aa05f514f61a">A02</a></div><div class="ttdeci">#define A02</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00069">lqg.c:69</a></div></div>
<div class="ttc" id="group___flight_math_html_gae92799bea6457224d138516adeeb30c1"><div class="ttname"><a href="group___flight_math.html#gae92799bea6457224d138516adeeb30c1">Q22</a></div><div class="ttdeci">#define Q22</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00081">lqg.c:81</a></div></div>
<div class="ttc" id="group___flight_math_html_ga97e9b30062b984f6d99412200fa7f8f8"><div class="ttname"><a href="group___flight_math.html#ga97e9b30062b984f6d99412200fa7f8f8">lqg_run_covariance</a></div><div class="ttdeci">void lqg_run_covariance(lqg_t lqg, int iter)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00513">lqg.c:513</a></div></div>
<div class="ttc" id="group___flight_math_html_ga502766f4c789280a257096ed8aff3c3b"><div class="ttname"><a href="group___flight_math.html#ga502766f4c789280a257096ed8aff3c3b">lqg_get_rtkf_state</a></div><div class="ttdeci">void lqg_get_rtkf_state(lqg_t lqg, float *rate, float *torque, float *bias)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00484">lqg.c:484</a></div></div>
<div class="ttc" id="group___flight_math_html_ga1ad6e702c34b118d4f9db7eb6d445bc2"><div class="ttname"><a href="group___flight_math.html#ga1ad6e702c34b118d4f9db7eb6d445bc2">rtkf_calculate_covariance_3x3</a></div><div class="ttdeci">void rtkf_calculate_covariance_3x3(float A[3][3], float K[3], float P[3][3], float Q[3][3], float R)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00102">lqg.c:102</a></div></div>
<div class="ttc" id="structlqr__state_html_a22f401cb64cae7f7761b04b4575ea04b"><div class="ttname"><a href="structlqr__state.html#a22f401cb64cae7f7761b04b4575ea04b">lqr_state::P</a></div><div class="ttdeci">float P[2][2]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00308">lqg.c:308</a></div></div>
<div class="ttc" id="group___flight_math_html_ga69da8b81ea4b9ca7dd631a4320794884"><div class="ttname"><a href="group___flight_math.html#ga69da8b81ea4b9ca7dd631a4320794884">A22</a></div><div class="ttdeci">#define A22</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00071">lqg.c:71</a></div></div>
<div class="ttc" id="group___flight_math_html_ga20c70bba8105b63590b5a49d99f563b5"><div class="ttname"><a href="group___flight_math.html#ga20c70bba8105b63590b5a49d99f563b5">P12</a></div><div class="ttdeci">#define P12</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00060">lqg.c:60</a></div></div>
<div class="ttc" id="group___flight_math_html_gaadecb1977e30da2f62766f1fcb8b1f95"><div class="ttname"><a href="group___flight_math.html#gaadecb1977e30da2f62766f1fcb8b1f95">K1</a></div><div class="ttdeci">#define K1</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00092">lqg.c:92</a></div></div>
<div class="ttc" id="structlqr__state_html_a171f2bb48d3868be0d9101c896d02058"><div class="ttname"><a href="structlqr__state.html#a171f2bb48d3868be0d9101c896d02058">lqr_state::tau</a></div><div class="ttdeci">float tau</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00313">lqg.c:313</a></div></div>
<div class="ttc" id="group___flight_math_html_gaa8394a82104d1917c30c5e017ccf6176"><div class="ttname"><a href="group___flight_math.html#gaa8394a82104d1917c30c5e017ccf6176">A11</a></div><div class="ttdeci">#define A11</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00067">lqg.c:67</a></div></div>
<div class="ttc" id="msp__messages_8h_html_a788e7e096258bec32986d7b2c00adebb"><div class="ttname"><a href="msp__messages_8h.html#a788e7e096258bec32986d7b2c00adebb">rate</a></div><div class="ttdeci">uint8_t rate</div><div class="ttdef"><b>Definition:</b> <a href="msp__messages_8h_source.html#l00099">msp_messages.h:99</a></div></div>
<div class="ttc" id="group___flight_math_html_gacea7ad10699d00bfb1215301dd1d6c39"><div class="ttname"><a href="group___flight_math.html#gacea7ad10699d00bfb1215301dd1d6c39">P00</a></div><div class="ttdeci">#define P00</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00053">lqg.c:53</a></div></div>
<div class="ttc" id="namespacepx__mkfw_html_ada4502124cbbf5a9984df3a21e079434"><div class="ttname"><a href="namespacepx__mkfw.html#ada4502124cbbf5a9984df3a21e079434">px_mkfw.f</a></div><div class="ttdeci">tuple f</div><div class="ttdef"><b>Definition:</b> <a href="px__mkfw_8py_source.html#l00081">px_mkfw.py:81</a></div></div>
<div class="ttc" id="group___flight_math_html_ga49e1cb9d119c0af92c6a35839b00aed6"><div class="ttname"><a href="group___flight_math.html#ga49e1cb9d119c0af92c6a35839b00aed6">lqg_is_solved</a></div><div class="ttdeci">bool lqg_is_solved(lqg_t lqg)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00498">lqg.c:498</a></div></div>
<div class="ttc" id="structlqr__state_html_a3b7e710c6b77111ff82a9c66e1e4f566"><div class="ttname"><a href="structlqr__state.html#a3b7e710c6b77111ff82a9c66e1e4f566">lqr_state::Q</a></div><div class="ttdeci">float Q[2][2]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00309">lqg.c:309</a></div></div>
<div class="ttc" id="group___flight_math_html_ga105b3dbbda7ff665ef1369a7ea42f29d"><div class="ttname"><a href="group___flight_math.html#ga105b3dbbda7ff665ef1369a7ea42f29d">A01</a></div><div class="ttdeci">#define A01</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00066">lqg.c:66</a></div></div>
<div class="ttc" id="group___flight_math_html_ga7e9d482db29da35ebe8c2c78b7e58278"><div class="ttname"><a href="group___flight_math.html#ga7e9d482db29da35ebe8c2c78b7e58278">rtkf_create</a></div><div class="ttdeci">rtkf_t rtkf_create(float beta, float tau, float Ts, float R, float q1, float q2, float q3, float biaslim)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00229">lqg.c:229</a></div></div>
<div class="ttc" id="group___flight_math_html_ga4de1a48d5eda65f9f4408c83a47ccb12"><div class="ttname"><a href="group___flight_math.html#ga4de1a48d5eda65f9f4408c83a47ccb12">lqr_is_solved</a></div><div class="ttdeci">bool lqr_is_solved(lqr_t lqr)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00364">lqg.c:364</a></div></div>
<div class="ttc" id="group___flight_math_html_gacaead781b2123d17bb02d52a973dec3f"><div class="ttname"><a href="group___flight_math.html#gacaead781b2123d17bb02d52a973dec3f">rtkf_initialize_matrices_int</a></div><div class="ttdeci">void rtkf_initialize_matrices_int(float A[3][3], float B[3], float beta, float tau, float Ts)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00210">lqg.c:210</a></div></div>
<div class="ttc" id="structrtkf__state_html_af8e7511a8a2816fa559c2273b8aba3be"><div class="ttname"><a href="structrtkf__state.html#af8e7511a8a2816fa559c2273b8aba3be">rtkf_state::Q</a></div><div class="ttdeci">float Q[3][3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00147">lqg.c:147</a></div></div>
<div class="ttc" id="structrtkf__state_html_a114e6c27b4df7671f75a9b63555db6d0"><div class="ttname"><a href="structrtkf__state.html#a114e6c27b4df7671f75a9b63555db6d0">rtkf_state::K</a></div><div class="ttdeci">float K[3]</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00145">lqg.c:145</a></div></div>
<div class="ttc" id="structrtkf__state_html_adc99dcabbdbb3e695e7f89b9be1a5d4d"><div class="ttname"><a href="structrtkf__state.html#adc99dcabbdbb3e695e7f89b9be1a5d4d">rtkf_state::biaslim</a></div><div class="ttdeci">float biaslim</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00151">lqg.c:151</a></div></div>
<div class="ttc" id="group___flight_math_html_ga05efb217998562804d47e5e23d6cc18a"><div class="ttname"><a href="group___flight_math.html#ga05efb217998562804d47e5e23d6cc18a">rtkf_predict_axis</a></div><div class="ttdeci">void rtkf_predict_axis(rtkf_t rtkf, float signal, float input, float Xout[3])</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00188">lqg.c:188</a></div></div>
<div class="ttc" id="group___flight_math_html_ga33f788605a598e63ac41746fa80a2748"><div class="ttname"><a href="group___flight_math.html#ga33f788605a598e63ac41746fa80a2748">P20</a></div><div class="ttdeci">#define P20</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00055">lqg.c:55</a></div></div>
<div class="ttc" id="group___flight_math_html_ga58f13c75497f1761e13cbf39acf83abc"><div class="ttname"><a href="group___flight_math.html#ga58f13c75497f1761e13cbf39acf83abc">LQR_SOLUTION_LIMIT</a></div><div class="ttdeci">#define LQR_SOLUTION_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00050">lqg.c:50</a></div></div>
<div class="ttc" id="structlqr__state_html"><div class="ttname"><a href="structlqr__state.html">lqr_state</a></div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00301">lqg.c:301</a></div></div>
<div class="ttc" id="group___flight_math_html_ga285430f44ab2578fa8b890a051a0ce94"><div class="ttname"><a href="group___flight_math.html#ga285430f44ab2578fa8b890a051a0ce94">lqg_controller</a></div><div class="ttdeci">float lqg_controller(lqg_t lqg, float signal, float setpoint)</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00450">lqg.c:450</a></div></div>
<div class="ttc" id="group___i_n_s_g_p_s_html_ga878335db1805364cefebddb5eccfc282"><div class="ttname"><a href="group___i_n_s_g_p_s.html#ga878335db1805364cefebddb5eccfc282">X</a></div><div class="ttdeci">float X[NUMX]</div><div class="ttdef"><b>Definition:</b> <a href="insgps14state_8c_source.html#l00066">insgps14state.c:66</a></div></div>
<div class="ttc" id="group___i_n_s_g_p_s_html_ga1a9a9b26f7cab8703fc488c6cc258490"><div class="ttname"><a href="group___i_n_s_g_p_s.html#ga1a9a9b26f7cab8703fc488c6cc258490">K</a></div><div class="ttdeci">float K[NUMX][NUMV]</div><div class="ttdef"><b>Definition:</b> <a href="insgps14state_8c_source.html#l00068">insgps14state.c:68</a></div></div>
<div class="ttc" id="structlqr__state_html_a58aaaf468f6763ec5c3c989fcabe364e"><div class="ttname"><a href="structlqr__state.html#a58aaaf468f6763ec5c3c989fcabe364e">lqr_state::u</a></div><div class="ttdeci">float u</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00310">lqg.c:310</a></div></div>
<div class="ttc" id="group___flight_math_html_ga84e5fa24b6bb47717a091f89de79b601"><div class="ttname"><a href="group___flight_math.html#ga84e5fa24b6bb47717a091f89de79b601">A12</a></div><div class="ttdeci">#define A12</div><div class="ttdef"><b>Definition:</b> <a href="lqg_8c_source.html#l00070">lqg.c:70</a></div></div>
<div class="ttc" id="group___p_i_o_s___d_e_b_u_g_html_gaec9900a29855911a9cfbfdd1cf7501b6"><div class="ttname"><a href="group___p_i_o_s___d_e_b_u_g.html#gaec9900a29855911a9cfbfdd1cf7501b6">PIOS_Assert</a></div><div class="ttdeci">#define PIOS_Assert(test)</div><div class="ttdef"><b>Definition:</b> <a href="inc_2pios__debug_8h_source.html#l00052">pios_debug.h:52</a></div></div>
<div class="ttc" id="pios__flashfs__logfs_8c_html_a13a6109e91ad12705df96a0f2743c630"><div class="ttname"><a href="pios__flashfs__logfs_8c.html#a13a6109e91ad12705df96a0f2743c630">state</a></div><div class="ttdeci">enum arena_state state</div><div class="ttdef"><b>Definition:</b> <a href="pios__flashfs__logfs_8c_source.html#l00073">pios_flashfs_logfs.c:73</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_aa98a92d0ee4a874a8da6d1a4d95ab49.html">flight</a></li><li class="navelem"><a class="el" href="dir_87fe40d6f8ed4c6aff829c2b720b8191.html">Libraries</a></li><li class="navelem"><a class="el" href="dir_441e28c588c74147da804bab46cd95fa.html">math</a></li><li class="navelem"><a class="el" href="lqg_8c.html">lqg.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
